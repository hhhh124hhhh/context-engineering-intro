# ğŸ”§ å‰ç«¯ç™»å½•422é”™è¯¯ä¿®å¤æ€»ç»“

## ğŸ¯ ä¿®å¤ç›®æ ‡

è§£å†³å‰ç«¯ç™»å½•é¡µé¢å‡ºç°çš„ **422 Unprocessable Entity** é”™è¯¯å’Œå…¶ä»–è¿è¡Œæ—¶é”™è¯¯ã€‚

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### ä¸»è¦é—®é¢˜
1. **æ•°æ®æ ¼å¼ä¸åŒ¹é…**: å‰ç«¯å‘é€ `username`ï¼Œåç«¯æœŸæœ› `username_or_email`
2. **ç¼ºå°‘å¿…éœ€å­—æ®µ**: å‰ç«¯æœªå‘é€ `remember_me` å­—æ®µ
3. **ç±»å‹å®šä¹‰ä¸ä¸€è‡´**: å‰åç«¯Useræ¥å£ç»“æ„å·®å¼‚å¾ˆå¤§
4. **æµè§ˆå™¨æ‰©å±•é”™è¯¯å¹²æ‰°**: å¤§é‡éå…³é”®é”™è¯¯æ±¡æŸ“æ§åˆ¶å°

### é”™è¯¯è¯¦æƒ…
```javascript
// å‰ç«¯å‘é€ (ä¿®å¤å‰)
{
  "username": "admin",
  "password": "Test123"
}

// åç«¯æœŸæœ›
{
  "username_or_email": "admin",
  "password": "Test123",
  "remember_me": false
}
```

## âœ… ä¿®å¤å†…å®¹

### 1. ç±»å‹å®šä¹‰ä¿®å¤ (`frontend/src/types/auth.ts`)

**ä¿®å¤å‰:**
```typescript
export interface LoginRequest {
  username: string
  password: string
}
```

**ä¿®å¤å:**
```typescript
export interface LoginRequest {
  username_or_email: string
  password: string
  remember_me?: boolean
}
```

**Useræ¥å£æ›´æ–°:**
- å®Œå…¨åŒ¹é…åç«¯ `UserResponse` ç»“æ„
- æ·»åŠ  `elo_rating`, `level`, `experience` ç­‰å­—æ®µ
- ç»Ÿä¸€å­—æ®µå‘½åçº¦å®š

### 2. è®¤è¯æœåŠ¡ä¿®å¤ (`frontend/src/services/authService.ts`)

**loginæ–¹æ³•ä¿®å¤:**
```typescript
async login(usernameOrEmail: string, password: string, rememberMe: boolean = false): Promise<AuthResponse> {
  const response = await apiClient.post<AuthResponse>('/auth/login', {
    username_or_email: usernameOrEmail,
    password,
    remember_me: rememberMe
  })
  // ...
}
```

**å¢å¼ºåŠŸèƒ½:**
- æ·»åŠ è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
- æ”¹è¿›é”™è¯¯å¤„ç†
- ä¿®å¤refreshTokenæ–¹æ³•

### 3. ç™»å½•é¡µé¢ä¿®å¤ (`frontend/src/pages/LoginPage.tsx`)

**å‚æ•°ä¼ é€’ä¿®å¤:**
```typescript
await login(formData.username, formData.password, formData.rememberMe)
```

### 4. è®¤è¯å­˜å‚¨ä¿®å¤ (`frontend/src/stores/authStore.ts`)

**åˆ·æ–°Tokenä¿®å¤:**
```typescript
const response = await authService.refreshToken() // ç§»é™¤é”™è¯¯çš„tokenå‚æ•°
```

**é”™è¯¯å¤„ç†æ”¹è¿›:**
- ä½¿ç”¨ `getErrorMessage()` å‡½æ•°
- æ·»åŠ è¯¦ç»†é”™è¯¯æ—¥å¿—

### 5. APIå®¢æˆ·ç«¯å¢å¼º (`frontend/src/services/apiClient.ts`)

**è°ƒè¯•æ—¥å¿—:**
```typescript
async post<T>(url: string, data?: any): Promise<T> {
  console.log(`ğŸ“¤ POSTè¯·æ±‚: ${this.baseURL}${url}`, { data })
  // ...
  console.error(`âŒ POSTè¯·æ±‚å¤±è´¥: ${url}`, {
    status: error.response?.status,
    data: error.response?.data,
    message: error.message
  })
}
```

### 6. é”™è¯¯è¿‡æ»¤å·¥å…· (`frontend/src/utils/errorFilter.ts`)

**åŠŸèƒ½ç‰¹æ€§:**
- è¿‡æ»¤æµè§ˆå™¨æ‰©å±•é”™è¯¯
- æä¾›ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
- æ”¯æŒHTTPçŠ¶æ€ç æ˜ å°„
- åˆ›å»ºè¿‡æ»¤åçš„æ§åˆ¶å°è¾“å‡º

### 7. ç¯å¢ƒé…ç½® (`frontend/.env`)

```env
VITE_API_URL=http://localhost:8000/api
VITE_APP_NAME=å¡ç‰Œå¯¹æˆ˜ç«æŠ€åœº
VITE_WS_URL=ws://localhost:8000/ws
VITE_DEBUG=true
```

### 8. åº”ç”¨å¯åŠ¨ä¼˜åŒ– (`frontend/src/App.tsx`)

**æ–°å¢åŠŸèƒ½:**
- è‡ªåŠ¨è¿‡æ»¤æµè§ˆå™¨æ‰©å±•é”™è¯¯
- æ·»åŠ åº”ç”¨å¯åŠ¨æ—¥å¿—
- æ”¹è¿›é”™è¯¯è¾¹ç•Œå¤„ç†

## ğŸ§ª æµ‹è¯•éªŒè¯

### è‡ªåŠ¨æµ‹è¯•è„šæœ¬
åˆ›å»ºäº† `frontend/test-login-fix.js` ç”¨äºåœ¨æµè§ˆå™¨æ§åˆ¶å°éªŒè¯ä¿®å¤ã€‚

### æµ‹è¯•è´¦å·
| ç”¨æˆ·å | å¯†ç  | è¯´æ˜ |
|--------|------|------|
| admin | Test123 | ç®¡ç†å‘˜è´¦å· |
| testuser | Test123 | æ™®é€šç”¨æˆ· |
| newbie | Test123 | æ–°æ‰‹ç”¨æˆ· |

## ğŸ¯ ä¿®å¤æ•ˆæœ

### è§£å†³çš„é—®é¢˜
1. âœ… **422é”™è¯¯** - æ•°æ®æ ¼å¼åŒ¹é…é—®é¢˜å®Œå…¨è§£å†³
2. âœ… **è¿è¡Œæ—¶é”™è¯¯** - æµè§ˆå™¨æ‰©å±•é”™è¯¯è¢«è¿‡æ»¤
3. âœ… **è°ƒè¯•å›°éš¾** - å¢åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
4. âœ… **ç”¨æˆ·ä½“éªŒ** - æä¾›æ›´å‹å¥½çš„é”™è¯¯æç¤º

### æ–°å¢åŠŸèƒ½
1. ğŸ” **è¯¦ç»†æ—¥å¿—** - æ¯ä¸ªAPIè¯·æ±‚éƒ½æœ‰å®Œæ•´æ—¥å¿—
2. ğŸ›¡ï¸ **é”™è¯¯è¿‡æ»¤** - è‡ªåŠ¨è¿‡æ»¤éå…³é”®é”™è¯¯
3. ğŸ“± **è®°ä½æˆ‘** - æ”¯æŒç™»å½•çŠ¶æ€æŒä¹…åŒ–
4. ğŸ”§ **ç¯å¢ƒé…ç½®** - æ”¯æŒä¸åŒç¯å¢ƒçš„APIé…ç½®

## ğŸš€ ä½¿ç”¨è¯´æ˜

### å¼€å‘ç¯å¢ƒå¯åŠ¨
1. ç¡®ä¿åç«¯æœåŠ¡è¿è¡Œåœ¨ `http://localhost:8000`
2. å‰ç«¯å¼€å‘æœåŠ¡å™¨: `npm run dev`
3. ä½¿ç”¨æµ‹è¯•è´¦å·ç™»å½•éªŒè¯åŠŸèƒ½

### è°ƒè¯•æŠ€å·§
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·æ§åˆ¶å°
2. æŸ¥çœ‹å¸¦è¡¨æƒ…ç¬¦å·çš„è°ƒè¯•æ—¥å¿—
3. å…³æ³¨ `ğŸ“¤` å’Œ `âœ…` æ ‡è®°çš„è¯·æ±‚/å“åº”æ—¥å¿—
4. é”™è¯¯æ—¥å¿—ä»¥ `âŒ` æ ‡è®°æ˜¾ç¤º

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
1. å¤åˆ¶ `.env.example` åˆ° `.env.production`
2. æ›´æ–° `VITE_API_URL` ä¸ºç”Ÿäº§ç¯å¢ƒåœ°å€
3. è®¾ç½® `VITE_DEBUG=false`

## ğŸ“Š æ€§èƒ½å½±å“

### ä¼˜åŒ–é¡¹ç›®
- é”™è¯¯è¿‡æ»¤å‡å°‘æ§åˆ¶å°å™ªéŸ³
- è¯¦ç»†æ—¥å¿—ä»…åœ¨å¼€å‘ç¯å¢ƒæ˜¾ç¤º
- æ”¹è¿›çš„é”™è¯¯å¤„ç†æå‡ç”¨æˆ·ä½“éªŒ

### æ³¨æ„äº‹é¡¹
- ç”Ÿäº§ç¯å¢ƒåº”å…³é—­è¯¦ç»†è°ƒè¯•æ—¥å¿—
- é”™è¯¯è¿‡æ»¤ä¸ä¼šå½±å“çœŸå®é”™è¯¯æŠ¥å‘Š
- ç¯å¢ƒå˜é‡éœ€è¦æ­£ç¡®é…ç½®

## ğŸ”® åç»­æ”¹è¿›å»ºè®®

1. **é›†æˆæµ‹è¯•** - æ·»åŠ ç«¯åˆ°ç«¯æµ‹è¯•è¦†ç›–ç™»å½•æµç¨‹
2. **é”™è¯¯ç›‘æ§** - é›†æˆSentryç­‰é”™è¯¯ç›‘æ§æœåŠ¡
3. **ç¼“å­˜ä¼˜åŒ–** - æ·»åŠ APIå“åº”ç¼“å­˜æœºåˆ¶
4. **ç¦»çº¿æ”¯æŒ** - æ·»åŠ ç¦»çº¿ç™»å½•çŠ¶æ€æ”¯æŒ

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-10-08
**ä¿®å¤èŒƒå›´**: å‰ç«¯ç™»å½•ç³»ç»Ÿå®Œæ•´ä¼˜åŒ–
**æµ‹è¯•çŠ¶æ€**: âœ… é€šè¿‡æ‰€æœ‰éªŒè¯æµ‹è¯•